<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Linear Timer – Stacked Agenda</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f7fb;
  padding: 20px;
}

.timer {
  background: white;
  padding: 16px;
  border-radius: 12px;
  max-width: 900px;
  margin-bottom: 24px;
  box-shadow: 0 6px 18px rgba(0,0,0,.08);
}

.bar-frame {
  position: relative;
  height: 44px;
  background: #e5e9f0;
  border-radius: 12px;
  margin-top: 16px;
  overflow: hidden;
}

.bar {
  position: relative;
  height: 100%;
}

.agenda {
  position: absolute;
  top: 6px;
  height: 32px;
  border-radius: 8px;
  font-size: 13px;
  padding: 6px 10px;
  cursor: grab;
  user-select: none;
  white-space: nowrap;
  font-weight: 600;
}

.controls input, .controls button {
  padding: 6px 8px;
  margin-right: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  background: #2563eb;
  color: white;
  border: none;
  cursor: pointer;
}
</style>
</head>

<body>

<h2>Linear Timer – Stacked Agenda Items</h2>

<div class="controls">
  <input id="timerName" placeholder="Timer name">
  <input id="startTime" type="time">
  <input id="endTime" type="time">
  <button onclick="addTimer()">Add Timer</button>
</div>

<div id="timers"></div>

<script>
const timers = [];

function timeToMinutes(t) {
  const [h, m] = t.split(':').map(Number);
  return h * 60 + m;
}

function addTimer() {
  if (!timerName.value || !startTime.value || !endTime.value) return;

  timers.push({
    id: Math.random(),
    name: timerName.value,
    start: timeToMinutes(startTime.value),
    end: timeToMinutes(endTime.value),
    agenda: []
  });

  render();
}

function timerDuration(t) {
  return t.end >= t.start
    ? t.end - t.start
    : 1440 - t.start + t.end;
}

function render() {
  const container = document.getElementById('timers');
  container.innerHTML = '';

  timers.forEach(timer => {
    const dur = timerDuration(timer);

    const div = document.createElement('div');
    div.className = 'timer';

    div.innerHTML = `
      <strong>${timer.name}</strong>
      <div class="bar-frame">
        <div class="bar" id="bar-${timer.id}"></div>
      </div>

      <div style="margin-top:12px">
        <input placeholder="Label" id="lbl-${timer.id}">
        <input type="number" placeholder="Minutes" id="min-${timer.id}" style="width:90px">
        <input type="color" id="bg-${timer.id}" value="#ef4444">
        <input type="color" id="fg-${timer.id}" value="#ffffff">
        <button onclick="addAgenda(${timer.id})">Add Agenda</button>
      </div>
    `;

    container.appendChild(div);
    renderAgenda(timer, dur);
  });
}

function addAgenda(timerId) {
  const timer = timers.find(t => t.id === timerId);
  const label = document.getElementById(`lbl-${timerId}`).value;
  const minutes = Number(document.getElementById(`min-${timerId}`).value);
  const bg = document.getElementById(`bg-${timerId}`).value;
  const fg = document.getElementById(`fg-${timerId}`).value;

  if (!label || !minutes) return;

  timer.agenda.push({
    id: Math.random(),
    label,
    minutes,
    bg,
    fg
  });

  render();
}

function renderAgenda(timer, totalMinutes) {
  const bar = document.getElementById(`bar-${timer.id}`);
  bar.innerHTML = '';

  let currentMinute = 0;

  timer.agenda.forEach((item, index) => {
    const widthPct = (item.minutes / totalMinutes) * 100;
    const leftPct = (currentMinute / totalMinutes) * 100;
    currentMinute += item.minutes;

    const el = document.createElement('div');
    el.className = 'agenda';
    el.textContent = item.label;
    el.style.width = widthPct + '%';
    el.style.left = leftPct + '%';
    el.style.background = item.bg;
    el.style.color = item.fg;

    bar.appendChild(el);

    let dragging = false;

    el.onpointerdown = e => {
      dragging = true;
      el.setPointerCapture(e.pointerId);
    };

    el.onpointerup = e => {
      dragging = false;
      el.releasePointerCapture(e.pointerId);
    };

    el.onpointermove = e => {
      if (!dragging) return;

      const rect = bar.getBoundingClientRect();
      let pct = ((e.clientX - rect.left) / rect.width) * 100;
      pct = Math.max(0, Math.min(100, pct));

      // snap to minute
      const snapMin = Math.round((pct / 100) * totalMinutes);

      // reorder agenda based on snapped position
      const newIndex = Math.min(
        timer.agenda.length - 1,
        Math.floor(snapMin / item.minutes)
      );

      timer.agenda.splice(index, 1);
      timer.agenda.splice(newIndex, 0, item);

      render();
    };
  });
}
</script>

</body>
</html>
