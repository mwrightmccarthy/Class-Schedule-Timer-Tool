<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Linear Classroom Timer</title>

<style>
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:#f6f8fb;
  margin:0;
  padding:20px;
}
.card{
  max-width:1100px;
  margin:auto;
  background:#fff;
  border-radius:14px;
  padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
.controls,input,button{
  font-size:14px;
}
.controls{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:16px;
}
input,button{
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #ddd;
}
button{
  background:#2563eb;
  color:#fff;
  border:none;
  cursor:pointer;
}
.timer{
  margin-top:20px;
}
.bar-wrapper{
  position:relative;
  margin-top:16px;
}
.bar{
  position:relative;
  height:42px;
  background:#e5e7eb;
  border-radius:12px;
  overflow:hidden;
}
.progress{
  position:absolute;
  left:0;
  top:0;
  height:100%;
  background:#2563eb;
  width:0%;
  transition:width .4s linear;
}
.start-label,.end-label{
  position:absolute;
  top:-24px;
  font-size:13px;
  font-weight:700;
  color:#fff;
  text-shadow:
    -1px -1px 0 #000,
     1px -1px 0 #000,
    -1px  1px 0 #000,
     1px  1px 0 #000;
}
.start-label{ left:0; }
.end-label{ right:0; }

.agenda-bar{
  position:absolute;
  top:0;
  height:100%;
  display:flex;
}
.agenda-item{
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  font-weight:700;
  color:#fff;
  white-space:nowrap;
  border-right:1px solid rgba(255,255,255,.4);
}

.info{
  margin-top:8px;
  display:flex;
  justify-content:space-between;
  font-weight:700;
}
.now{
  margin-top:12px;
  font-size:18px;
  font-weight:800;
}
.agenda-inputs{
  margin-top:16px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
</style>
</head>

<body>
<div class="card">
  <h2>Linear Classroom Timer</h2>

  <div class="controls">
    <input id="name" placeholder="Timer name">
    <input id="start" type="time">
    <input id="end" type="time">
    <button onclick="createTimer()">Create Timer</button>
  </div>

  <div id="app"></div>
</div>

<script>
let timer=null;

function minutes(t){
  const [h,m]=t.split(':').map(Number);
  return h*60+m;
}

function createTimer(){
  const name=document.getElementById('name').value;
  const start=document.getElementById('start').value;
  const end=document.getElementById('end').value;
  if(!name||!start||!end) return alert('Fill all fields');

  timer={
    name,
    start,
    end,
    s:minutes(start),
    e:minutes(end),
    agenda:[]
  };
  render();
}

function addAgenda(){
  const label=document.getElementById('aLabel').value;
  const mins=Number(document.getElementById('aMins').value);
  const color=document.getElementById('aColor').value;
  if(!label||!mins) return;

  timer.agenda.push({label,mins,color});
  document.getElementById('aLabel').value='';
  document.getElementById('aMins').value='';
  render();
}

function render(){
  const dur=timer.e-timer.s;
  let html=`
  <div class="timer">
    <h3>${timer.name}</h3>

    <div class="bar-wrapper">
      <div class="start-label">${timer.start}</div>
      <div class="end-label">${timer.end}</div>

      <div class="bar">
        <div class="agenda-bar" id="agenda"></div>
        <div class="progress" id="progress"></div>
      </div>
    </div>

    <div class="info">
      <div id="elapsed">0 min (0%)</div>
      <div id="remaining">${dur} min left</div>
    </div>

    <div class="now" id="now">Now happening: —</div>

    <div class="agenda-inputs">
      <input id="aLabel" placeholder="Agenda item">
      <input id="aMins" type="number" placeholder="Minutes">
      <input id="aColor" type="color" value="#16a34a">
      <button onclick="addAgenda()">Add Agenda</button>
    </div>
  </div>
  `;
  document.getElementById('app').innerHTML=html;

  const agendaBar=document.getElementById('agenda');
  let used=0;
  timer.agenda.forEach(a=>{
    const w=(a.mins/dur)*100;
    const div=document.createElement('div');
    div.className='agenda-item';
    div.style.width=w+'%';
    div.style.background=a.color;
    div.textContent=a.label;
    agendaBar.appendChild(div);
    used+=a.mins;
  });

  update();
}

function update(){
  if(!timer) return;
  const now=new Date();
  const nowMin=now.getHours()*60+now.getMinutes();
  const dur=timer.e-timer.s;
  let elapsed=Math.max(0,Math.min(dur,nowMin-timer.s));
  const pct=(elapsed/dur)*100;

  document.getElementById('progress').style.width=pct+'%';
  document.getElementById('elapsed').textContent=
    `${elapsed} min (${pct.toFixed(1)}%)`;
  document.getElementById('remaining').textContent=
    `${dur-elapsed} min left`;

  let acc=0, current='—';
  for(const a of timer.agenda){
    acc+=a.mins;
    if(elapsed<=acc){ current=a.label; break; }
  }
  document.getElementById('now').textContent=
    `Now happening: ${current}`;
}

setInterval(update,1000);
</script>
</body>
</html>
