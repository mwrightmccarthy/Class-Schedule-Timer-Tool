<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Linear Agenda Timer</title>

<style>
:root{
  --bg:#f6f8fb;
  --card:#ffffff;
}

body{
  margin:0;
  padding:24px;
  background:var(--bg);
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  display:flex;
  justify-content:center;
}

.wrap{width:100%;max-width:1100px}

.card{
  background:var(--card);
  padding:16px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.controls{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:16px;
}

input,button{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:14px;
}

button{
  background:#2563eb;
  color:white;
  border:none;
  cursor:pointer;
}

.bar-frame{
  position:relative;
  height:42px;
  background:#e5e7eb;
  border-radius:12px;
  overflow:hidden;
}

.agenda-layer{
  position:absolute;
  inset:0;
  z-index:2;
}

.progress{
  position:absolute;
  inset:0;
  width:0%;
  background:rgba(0,0,0,.35);
  z-index:3;
  pointer-events:none;
}

.bar-text{
  position:absolute;
  inset:0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 14px;
  font-weight:700;
  color:white;
  text-shadow:0 0 3px black;
  z-index:4;
}

.agenda-item{
  position:absolute;
  top:6px;
  height:30px;
  border-radius:8px;
  color:white;
  font-size:13px;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:grab;
  user-select:none;
}

.mins{
  display:flex;
  justify-content:space-between;
  margin-top:8px;
  font-weight:600;
}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<div class="controls">
  <input id="start" type="time">
  <input id="end" type="time">
  <button onclick="init()">Start Timer</button>
</div>

<div class="bar-frame" id="bar">
  <div class="agenda-layer" id="agendaLayer"></div>
  <div class="progress" id="progress"></div>
  <div class="bar-text">
    <div id="elapsedText">0%</div>
    <div id="remainText">100%</div>
  </div>
</div>

<div class="mins">
  <div id="gone">0 min elapsed</div>
  <div id="left">0 min remaining</div>
</div>

<div class="controls" style="margin-top:12px">
  <input id="label" placeholder="Agenda name">
  <input id="minutes" type="number" placeholder="Minutes">
  <input id="color" type="color" value="#f97316">
  <button onclick="addAgenda()">Add Agenda</button>
</div>

</div>
</div>

<script>
let startMin,endMin,total;
let agendas=[];
const bar=document.getElementById('bar');

function toMin(t){
  const[h,m]=t.split(':').map(Number);
  return h*60+m;
}

function init(){
  startMin=toMin(start.value);
  endMin=toMin(end.value);
  total=endMin-startMin;
  update();
  setInterval(update,1000);
}

function addAgenda(){
  const labelVal=document.getElementById('label').value.trim();
  const minVal=Number(document.getElementById('minutes').value);
  const colorVal=document.getElementById('color').value;

  if(!labelVal||!minVal) return;

  agendas.push({
    id:crypto.randomUUID(),
    label:labelVal,
    minutes:minVal,
    color:colorVal,
    offset:agendas.reduce((s,a)=>s+a.minutes,0)
  });

  renderAgenda();
}

function renderAgenda(){
  agendaLayer.innerHTML='';
  agendas.forEach(a=>{
    const el=document.createElement('div');
    el.className='agenda-item';
    el.textContent=`${a.label} ${a.minutes}m`;
    el.style.background=a.color;
    el.style.width=(a.minutes/total*100)+'%';
    el.style.left=(a.offset/total*100)+'%';
    makeDraggable(el,a);
    agendaLayer.appendChild(el);
  });
}

function makeDraggable(el,a){
  let startX,startOffset;
  el.onpointerdown=e=>{
    startX=e.clientX;
    startOffset=a.offset;
    el.setPointerCapture(e.pointerId);

    document.onpointermove=ev=>{
      const dx=ev.clientX-startX;
      const minPerPx=total/bar.offsetWidth;
      let mins=Math.round(startOffset+dx*minPerPx);
      mins=Math.max(0,Math.min(total-a.minutes,mins));
      a.offset=mins;
      snap();
      renderAgenda();
    };

    document.onpointerup=()=>{
      document.onpointermove=null;
    };
  };
}

function snap(){
  agendas.sort((a,b)=>a.offset-b.offset);
  let cursor=0;
  agendas.forEach(a=>{
    a.offset=cursor;
    cursor+=a.minutes;
  });
}

function update(){
  if(!total) return;
  const now=new Date();
  const nowMin=now.getHours()*60+now.getMinutes()+now.getSeconds()/60;
  const elapsed=Math.min(total,Math.max(0,nowMin-startMin));
  const pct=elapsed/total*100;

  progress.style.width=pct+'%';
  elapsedText.textContent=pct.toFixed(1)+'%';
  remainText.textContent=(100-pct).toFixed(1)+'%';
  gone.textContent=Math.floor(elapsed)+' min elapsed';
  left.textContent=Math.ceil(total-elapsed)+' min remaining';
}
</script>
</body>
</html>
