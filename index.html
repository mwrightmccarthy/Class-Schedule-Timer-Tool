<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Linear Timer â€“ Agenda Snap Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f7fb;
    padding: 20px;
  }

  .timer {
    background: white;
    padding: 16px;
    border-radius: 10px;
    max-width: 900px;
    margin-bottom: 20px;
    box-shadow: 0 6px 18px rgba(0,0,0,.08);
  }

  .bar-frame {
    position: relative;
    height: 40px;
    background: #e5e9f0;
    border-radius: 10px;
    margin-top: 16px;
  }

  .bar {
    position: relative;
    height: 100%;
    border-radius: 10px;
  }

  .agenda {
    position: absolute;
    top: -34px;
    height: 28px;
    border-radius: 6px;
    background: #ef4444;
    color: white;
    font-size: 13px;
    padding: 4px 8px;
    cursor: grab;
    user-select: none;
    white-space: nowrap;
  }

  input, button {
    padding: 6px 8px;
    margin-right: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  button {
    background: #2563eb;
    color: white;
    border: none;
    cursor: pointer;
  }
</style>
</head>

<body>

<h2>Linear Timer (Agenda Snap Test)</h2>

<div>
  <input id="timerName" placeholder="Timer name">
  <input id="startTime" type="time">
  <input id="endTime" type="time">
  <button onclick="addTimer()">Add Timer</button>
</div>

<div id="timers"></div>

<script>
const timers = [];

function timeToMinutes(t) {
  const [h, m] = t.split(':').map(Number);
  return h * 60 + m;
}

function addTimer() {
  const name = timerName.value;
  const start = startTime.value;
  const end = endTime.value;
  if (!name || !start || !end) return;

  const timer = {
    id: Math.random(),
    name,
    startMin: timeToMinutes(start),
    endMin: timeToMinutes(end),
    agenda: []
  };

  timers.push(timer);
  render();
}

function render() {
  const container = document.getElementById('timers');
  container.innerHTML = '';

  timers.forEach(timer => {
    const duration =
      timer.endMin >= timer.startMin
        ? timer.endMin - timer.startMin
        : 1440 - timer.startMin + timer.endMin;

    const div = document.createElement('div');
    div.className = 'timer';

    div.innerHTML = `
      <strong>${timer.name}</strong>
      <div class="bar-frame">
        <div class="bar" id="bar-${timer.id}"></div>
      </div>
      <button onclick="addAgenda(${timer.id})">Add Agenda Item</button>
    `;

    container.appendChild(div);
    drawAgenda(timer, duration);
  });
}

function addAgenda(timerId) {
  const timer = timers.find(t => t.id === timerId);
  timer.agenda.push({
    id: Math.random(),
    label: 'Agenda',
    minutes: 10,
    percent: 0
  });
  render();
}

function drawAgenda(timer, totalMinutes) {
  const bar = document.getElementById(`bar-${timer.id}`);
  bar.innerHTML = '';

  timer.agenda.forEach(item => {
    const el = document.createElement('div');
    el.className = 'agenda';
    el.textContent = item.label;

    const widthPct = (item.minutes / totalMinutes) * 100;
    el.style.width = widthPct + '%';
    el.style.left = item.percent + '%';

    bar.appendChild(el);

    let dragging = false;
    let barRect;

    el.onpointerdown = e => {
      dragging = true;
      barRect = bar.getBoundingClientRect();
      el.setPointerCapture(e.pointerId);
    };

    window.onpointermove = e => {
      if (!dragging) return;

      let pct = ((e.clientX - barRect.left) / barRect.width) * 100;

      // snap to 1-minute increments
      const snappedMinutes = Math.round((pct / 100) * totalMinutes);
      pct = (snappedMinutes / totalMinutes) * 100;

      pct = Math.max(0, Math.min(100 - widthPct, pct));
      el.style.left = pct + '%';
      item.percent = pct;
    };

    window.onpointerup = () => dragging = false;
  });
}
</script>

</body>
</html>
